extends layout
block scripts
  script(src='../jquery.min.js')
  script(src='../js/bootstrap.min.js')

block content
  button( id='button') Button
  script.
    let ws;
    document.addEventListener( "DOMContentLoaded", () => {
      console.log( 'dom loaded' );
      $('#button').click( ()=> {
        ws.send(JSON.stringify( {message:'lol'}));
      });
      startWebSocket();
    });
    function startWebSocket()
    {
      var websocketAddress = `ws://${window.location.host}`;
      console.log( 'connecting websocket at ' + websocketAddress );
      ws = new WebSocket(websocketAddress);
      //- let ws = new WebSocket( 'ws://127.0.0.1:3000' );
      //- let ws = new WebSocket('ws://localhost:8080' );
      ws.addEventListener( 'open', (e)=> {
        console.log( 'open' );
      });
      ws.addEventListener( 'close', (e)=> {
        console.log( 'close: ' + e );
      });

      ws.addEventListener( 'error', (e)=> {
        console.log( 'error' );
      });

      ws.addEventListener( 'message', (event) => {
        const data = JSON.parse( event.data );
        console.log( 'message: ' + data.message );
      });
    }
